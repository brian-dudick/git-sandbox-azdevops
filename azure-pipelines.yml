# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
  branches:
    include:
      - Feature*
      - Hotfix*
      - Release-*
      - master
    exclude:
      - master
  paths:
    exclude:
    - README.md
    - /docs/*
pr:
  branches:
    include:
    - master
    - Development
    - Release-*

pool:
    name: 'Hosted VS2017'
    vmImage: vs2017-win2016
    demands: MSBuild

name: $(TeamProject)_$(BuildDefinitionName)_$(SourceBranchName)_$(Date:yyyyMMdd)$(Rev:.r)

variables:
  CI_NAME: Azure Pipelines
  GIT_BRANCH: $(Build.SourceBranchName)
  MS_BUILD_DEFAULT_ARGS: /P:Configuration=Release;DeployOnBuild=true;PackageLocation="$(Build.ArtifactStagingDirectory)\CoConstructSite-$(Build.BuildId).zip
  buildPlatform: 'Any CPU'

steps:
#- template: build/azure-pipelines/build.yml

- template: build/azure-pipelines/get-predefined-vars.yml
- template: build/azure-pipelines/build-app-01.yml
- template: build/azure-pipelines/find-postbuild-items.yml

#1) Rebuild Co-Construct Site Solution

#2) Build Main Site Project

#3) BUild Mobile API Project

# 4) Build File Server Project

#5) Copy EmailProcessor

#6) Copy TaskProcessor

#7) Publish Artifacts
- template: build/azure-pipelines/publish-artifacts.yml

